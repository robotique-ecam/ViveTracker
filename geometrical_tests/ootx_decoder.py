import sys

sys.path.append("../")


from ootx_data import ootx_data  # this is the array from data_tests/ootx_shaped
from bmc_decoder.bmc_decoder import SingleWord
from polynomials.polynomial_finder import PolynomialIdentifier
from timestamp_computing import TimestampComputing
from lfsr.lfsr import LFSR

ts_computing = TimestampComputing()
ootx = ""

for words in ootx_data:

    diff_ts = ts_computing.get_ts_diff(words[0][1], words[1][1])

    first_word = SingleWord(waveform=[], start_timestamp=0, data=words[0][0])
    second_word = SingleWord(waveform=[], start_timestamp=diff_ts, data=words[1][0])

    identifier = PolynomialIdentifier(first_word, second_word, first_two_polys=True)
    resulting_polys = identifier.search_polynomial()

    if hasattr(resulting_polys[0], "polynomial"):
        poly = resulting_polys[0].polynomial

        if poly == 0x1D258:
            ootx += "0"
        elif poly == 0x17E04:
            ootx += "1"
    else:
        print(hex(words[0][1]))
        print(diff_ts)
        ootx += " "

print(ootx)

"""
00000111010001000001011 110010100000000000000000100 010  000000001 0001000000010001011101 01100 0111011001001100110110000000000000000110010110000 0001110111000101010101110000 00010100110000000 00001111100010100 0100110 1000001000 10 1    1111100111111 100000000  0 00010 1 1100000101011001 1110100010111100110111 001010110011101 00000001000000001110010010011011000001010 00111110001000101001011110   10101001100001 0 0100 100001010000000011110000011101000100000 0111110010 0000000000000000010010 0110000000011000 00000001000101110110 100101 10 100 001100110110000000000000000110010 1000010001110 1100010 010101110000100010100110000000 000011 11000 0100101001101 0000010001101111111111100 11111110000000011011000100 1110000010101 001111101000101 1 00110111 001010110011 0 1000000010000000011100 001001101100000 0101001111100010001010010 11101101010100 100 01 010100110000101000000001111000001110100010000010111 10010100000000000000000100101011000000001 000100000001000 011101101100101110 1001001100110110000000000000000110 1011000010001110111000101010101110000100010100110000000 000011111000101001010011011000001 001 01111111 1110011111111000000001101 00010011110000010101100  111010001011 1001 011 10010101 0011 0110000000100000000 11001001001101 0000010 01001111100010001010010111101101010 0011000011010100110000101000000001111000001110 00010000010 11 1001010000000000000000010010101100000 00 10001000000010001011101101100101110110010011001101100000000000000001100101100001000111011100010 010101110000100010100110000000100001111100010100101001 011000001000110111111 1 11001 1 11 100000000110110001001  10000010101100111110100010111100110111 0010101100 110 10000  01000000 0111001 0100 101100000101 1001111100010001 10010 111 11010101001 00001101010011000010100000000 111000001 10 00010000010 11 100101000000000000000001001010 10000000 110001000000010001011101101100 01110 1001001100  011000 0000000000001100 0 10000100011101 1000101010101110 001000 0100110000000 00001111 0001010010100110110 000 000110 1
"""
